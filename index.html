<html>
  <head>
    <title></title>
    <style>
      body {
        background:#448;
        width:100%;
        height:100%;
        margin:0;
        overflow:hidden;
      }
      #c {
        background:#000;
      }
    </style>
  </head>
  <body
    onresize="redraw()"
    onmousedown="mousedown(event)"
    onmouseup="mouseup(event)"
    onmousemove="mousemove(event)"
  >
    <canvas width="400" height="400" id="c" />
  </body>
  <script>
    g = Object();
    g.vars = [
     100,             // Capacitance.
     100,             // Inductance.
     100,             // Resistance.
     null,            // Left edge.
     null,            // Right edge.
    ];
    g.sel = null;     // Selected variable.
    g.ox = null;      // Old x value.
    g.moved = 0;      // The mouse moved this far.
    g.queued = 0;     // Redraw is queued.

    function redraw() {
      box = document.body.getBoundingClientRect();
      var c = document.getElementById("c");
      var w = box.width;
      var h = box.height;
      c.width = w;
      c.height = h;
      var ctx = c.getContext("2d");

      ctx.fillStyle = "#ccc";
      ctx.lineWidth = "3";

      for (var i=0; i<5; i++) {
        ctx.beginPath()
        ctx.moveTo(0,30+30*i);
        ctx.lineTo(w,30+30*i);
        var x = g.vars[i];
        if (x != null) {
          ctx.moveTo(x,20+30*i);
          ctx.lineTo(x,40+30*i);
          ctx.strokeStyle = "#ccc";
        } else {
          ctx.strokeStyle = "#888";
        }
        ctx.stroke();
      }

      var h1 = 6*30;
      var h2 = h-h1;
      var y1 = (h1+h)/2;

      ctx.strokeStyle = "#ccc";
      ctx.beginPath();
      ctx.moveTo(0,y1);
      ctx.lineTo(w,y1);
      ctx.stroke();

      var dt = 0.05;

      ctx.strokeStyle = "#cc0";
      ctx.beginPath();
      ctx.moveTo(0,y1);
      for(var x=0;x<w;x++) {
        var y;
        if ( (g.vars[3] != null && x < g.vars[3]) ||
             (g.vars[4] != null && x > g.vars[4]) ) {
          y = 0;
        } else {
          y = (h2/3)*Math.sin(x*dt);
        }
        ctx.lineTo(x,y1+y);
      }
      ctx.stroke();

      var C = g.vars[0] * 4 / w;
      var L = g.vars[1] * 4 / w;
      var R = g.vars[2] * 4 / w;
      var Vc = 0;
      var Il = 0;
      ctx.strokeStyle = "#0cc";
      ctx.beginPath();
      ctx.moveTo(0,y1);
      for(var x=0;x<w;x++) {
        var y;
        if ( (g.vars[3] != null && x < g.vars[3]) ||
             (g.vars[4] != null && x > g.vars[4]) ) {
          y = 0;
        } else {
          y = (h2/3)*Math.sin(x*dt);
        }
        var Vr = y - Vc;
        ctx.lineTo(x,y1+Vr);

        var Ir = Vr/R;
        var Ic = Ir - Il;
        Vc = Vc + (Ic/C)*dt;
        Il = Il + (Vc/L)*dt;
      }
      ctx.stroke();
    }

    function timeout() {
      g.queued = 0;
      redraw();
    }

    function queue_redraw() {
      if (g.queued) {
        return;
      }
      setTimeout(timeout, 10);
      g.queued = 1;
    }

    function y_to_i(y) {
      var i = Math.floor((y-20)/30);
      var dy = y - (i*30 + 20);
      if (i >= 0 && i < 5 && dy <= 20) {
        return i;
      }
      return null;
    }

    function deselect() {
      if (g.sel != null) {
        g.vars[g.sel] = g.ox;
      }
      g.sel = null;
    }

    function mousedown(e) {
      deselect();
      var i = y_to_i(e.y);
      if (i != null) {
        g.sel = i;
        g.ox = g.vars[i];
        g.moved = Math.abs(e.x-g.ox);
        g.vars[i] = e.x;
      }
      queue_redraw();
    }

    function mouseup(e) {
      if (g.sel != null) {
        if (g.sel >= 3 && g.moved < 5 && g.ox != null) {
          g.vars[g.sel] = null;
        } else {
          g.vars[g.sel] = e.x;
        }
        g.sel = null;
      } else {
        deselect();
      }
      queue_redraw();
    }

    function mousemove(e) {
      if ((e.buttons & 1) == 0) {
        deselect();
      }
      if (g.sel != null) {
        var dx = Math.abs(e.x-g.ox)
        if (dx > g.moved) {
          g.moved = dx;
        }
        g.vars[g.sel] = e.x;
      }
      queue_redraw();
    }

    redraw();
  </script>
</html>
